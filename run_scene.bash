export SCENE=scene0354_00
export MODEL=2984
bsub -J $SCENE-pred -n 4 -R singularity -R "rusage[mem=30000,scratch=10000,ngpus_excl_p=1]" -W 4:00 "singularity run --nv --bind /cluster/home/blumh/tensorflow_datasets:/cluster/home/blumh/tensorflow_datasets --bind \$TMPDIR:/tmp --bind /cluster/scratch/blumh/:/cluster/scratch/blumh/ /cluster/work/riner/users/blumh/clustering.simg bash -c 'cd /semseg && python3 deeplab/scannet_inference.py with subset=scene0354_00 pretrained_model=2984'"
bsub -J $SCENE-map -w "done($SCENE-pred)" -n 4 -R singularity -R "rusage[mem=30000,scratch=100000,ngpus_excl_p=1]" -W 4:00 "singularity run --nv --bind /cluster/work/riner/users/blumh:/cluster/work/riner/users/blumh --bind /cluster/home/blumh/tensorflow_datasets:/cluster/home/blumh/tensorflow_datasets --bind \$TMPDIR:/tmp --bind /cluster/scratch/blumh/:/cluster/scratch/blumh/ /cluster/work/riner/users/blumh/clustering.simg bash -c 'cp /cluster/work/riner/users/blumh/valscans.zip /tmp && unzip /tmp/valscans.zip $SCENE/* -d /tmp && . /ws/devel/setup.bash && mkdir /tmp/roslog && ROS_HOME=/tmp/roslog ROS_LOG_DIR=/tmp/roslog roslaunch panoptic_mapping_utils scannnet_mapping.launch scene:=$SCENE model:=$MODEL data_path:=/tmp/$SCENE inference_path:=/cluster/scratch/blumh/clustering_outputs/scannet_inference/$SCENE/$MODEL'"
bsub -J $SCENE-uncertmap -w "done($SCENE-pred)" -n 4 -R singularity -R "rusage[mem=30000,scratch=100000,ngpus_excl_p=1]" -W 4:00 "singularity run --nv --bind /cluster/work/riner/users/blumh:/cluster/work/riner/users/blumh --bind /cluster/home/blumh/tensorflow_datasets:/cluster/home/blumh/tensorflow_datasets --bind \$TMPDIR:/tmp --bind /cluster/scratch/blumh/:/cluster/scratch/blumh/ /cluster/work/riner/users/blumh/clustering.simg bash -c 'export ROS_ROOT=/tmp && cp /cluster/work/riner/users/blumh/valscans.zip /tmp && unzip /tmp/valscans.zip $SCENE/* -d /tmp && . /ws/devel/setup.bash && mkdir /tmp/roslog && ROS_HOME=/tmp/roslog ROS_LOG_DIR=/tmp/roslog roslaunch -p 11316 panoptic_mapping_utils scannnet_uncertmap.launch scene:=$SCENE model:=$MODEL data_path:=/tmp/$SCENE inference_path:=/cluster/scratch/blumh/clustering_outputs/scannet_inference/$SCENE/$MODEL'"
bsub -J $SCENE-renderpred -w "done($SCENE-map)" -n 4 -R singularity -R "rusage[mem=30000,scratch=100000,ngpus_excl_p=1]" -W 4:00 "singularity run --nv --bind /cluster/work/riner/users/blumh:/cluster/work/riner/users/blumh --bind /cluster/home/blumh/tensorflow_datasets:/cluster/home/blumh/tensorflow_datasets --bind \$TMPDIR:/tmp --bind /cluster/scratch/blumh/:/cluster/scratch/blumh/ /cluster/work/riner/users/blumh/clustering.simg bash -c 'export ROS_ROOT=/tmp && cp /cluster/work/riner/users/blumh/valscans.zip /tmp && unzip /tmp/valscans.zip $SCENE/* -d /tmp && . /ws/devel/setup.bash && mkdir /tmp/roslog && ROS_HOME=/tmp/roslog ROS_LOG_DIR=/tmp/roslog roslaunch -p 11315 panoptic_mapping_utils scannnet_predrender.launch scene:=$SCENE model:=$MODEL wait:=60 data_path:=/tmp/$SCENE inference_path:=/cluster/scratch/blumh/clustering_outputs/scannet_inference/$SCENE/$MODEL'"
bsub -J $SCENE-rendervox -w "done($SCENE-map)" -n 4 -R singularity -R "rusage[mem=30000,scratch=100000,ngpus_excl_p=1]" -W 4:00 "singularity run --nv --bind /cluster/work/riner/users/blumh:/cluster/work/riner/users/blumh --bind /cluster/home/blumh/tensorflow_datasets:/cluster/home/blumh/tensorflow_datasets --bind \$TMPDIR:/tmp --bind /cluster/scratch/blumh/:/cluster/scratch/blumh/ /cluster/work/riner/users/blumh/clustering.simg bash -c 'export ROS_ROOT=/tmp && cp /cluster/work/riner/users/blumh/valscans.zip /tmp && unzip /tmp/valscans.zip $SCENE/* -d /tmp && . /ws/devel/setup.bash && mkdir /tmp/roslog && ROS_HOME=/tmp/roslog ROS_LOG_DIR=/tmp/roslog roslaunch -p 11314 panoptic_mapping_utils scannnet_voxelidrender.launch scene:=$SCENE model:=$MODEL wait:=60 data_path:=/tmp/$SCENE inference_path:=/cluster/scratch/blumh/clustering_outputs/scannet_inference/$SCENE/$MODEL'"
bsub -J $SCENE-renderuncert -w "done($SCENE-uncertmap)" -n 4 -R singularity -R "rusage[mem=30000,scratch=100000,ngpus_excl_p=1]" -W 4:00 "singularity run --nv --bind /cluster/work/riner/users/blumh:/cluster/work/riner/users/blumh --bind /cluster/home/blumh/tensorflow_datasets:/cluster/home/blumh/tensorflow_datasets --bind \$TMPDIR:/tmp --bind /cluster/scratch/blumh/:/cluster/scratch/blumh/ /cluster/work/riner/users/blumh/clustering.simg bash -c 'export ROS_ROOT=/tmp && cp /cluster/work/riner/users/blumh/valscans.zip /tmp && unzip /tmp/valscans.zip $SCENE/* -d /tmp && . /ws/devel/setup.bash && mkdir /tmp/roslog && ROS_HOME=/tmp/roslog ROS_LOG_DIR=/tmp/roslog roslaunch -p 11313 panoptic_mapping_utils scannnet_uncertrender.launch scene:=$SCENE model:=$MODEL wait:=60 data_path:=/tmp/$SCENE inference_path:=/cluster/scratch/blumh/clustering_outputs/scannet_inference/$SCENE/$MODEL'"

bsub -J $SCENE-geofeat  -w "done($SCENE-renderpred)" -n 4 -R singularity -R "rusage[mem=30000,scratch=100000,ngpus_excl_p=1]" -W 4:00 -I  "singularity run --nv --bind /cluster/scratch/blumh/clustering_outputs/scannet_inference/$SCENE/$MODEL/point_cloud_0.ply:/pc.ply --bind /cluster/scratch/blumh/clustering_outputs/scannet_inference/$SCENE/$MODEL/smoothnet:/output --bind /cluster/scratch/blumh/smoothnet_data/evaluate:/3DSmoothNet/data/evaluate --bind /cluster/scratch/blumh/smoothnet_data/logs:/3DSmoothNet/logs --bind /cluster/scratch/blumh/smoothnet_data/preprocessed:/preprocessed /cluster/work/riner/users/blumh/smoothnet.simg"
bsub -J $SCENE-rendergeo -w "done($SCENE-geofeat)" -n 4 -R singularity -R "rusage[mem=30000,scratch=100000,ngpus_excl_p=1]" -W 4:00 "singularity run --nv --bind /cluster/work/riner/users/blumh:/cluster/work/riner/users/blumh --bind /cluster/home/blumh/tensorflow_datasets:/cluster/home/blumh/tensorflow_datasets --bind \$TMPDIR:/tmp --bind /cluster/scratch/blumh/:/cluster/scratch/blumh/ /cluster/work/riner/users/blumh/clustering.simg bash -c 'export ROS_ROOT=/tmp && cp /cluster/work/riner/users/blumh/valscans.zip /tmp && unzip /tmp/valscans.zip $SCENE/* -d /tmp && . /ws/devel/setup.bash && mkdir /tmp/roslog && ROS_HOME=/tmp/roslog ROS_LOG_DIR=/tmp/roslog roslaunch -p 11312 panoptic_mapping_utils scannnet_geofeatures.launch scene:=$SCENE model:=$MODEL wait:=60 data_path:=/tmp/$SCENE inference_path:=/cluster/scratch/blumh/clustering_outputs/scannet_inference/$SCENE/$MODEL'"

bsub -w "done($SCENE-renderuncert) && done($SCENE-renderpred)" -n 4 -R singularity -R "rusage[mem=30000,scratch=10000,ngpus_excl_p=1]" -W 4:00 "singularity run --nv --bind /cluster/home/blumh/tensorflow_datasets:/cluster/home/blumh/tensorflow_datasets --bind \$TMPDIR:/tmp --bind /cluster/scratch/blumh/:/cluster/scratch/blumh/ /cluster/work/riner/users/blumh/clustering.simg bash -c 'cd /semseg && python3 deeplab/scannet_dbscan.py best_dbscan  with subset=$SCENE pretrained_model=$MODEL n_calls=200'"
bsub -w "done($SCENE-renderuncert) && done($SCENE-renderpred)" -n 4 -R singularity -R "rusage[mem=30000,scratch=10000,ngpus_excl_p=1]" -W 4:00 "singularity run --nv --bind /cluster/home/blumh/tensorflow_datasets:/cluster/home/blumh/tensorflow_datasets --bind \$TMPDIR:/tmp --bind /cluster/scratch/blumh/:/cluster/scratch/blumh/ /cluster/work/riner/users/blumh/clustering.simg bash -c 'cd /semseg && python3 deeplab/scannet_dbscan.py best_hdbscan  with subset=$SCENE pretrained_model=$MODEL cluster_selection_method=eom n_calls=200'"
bsub -w "done($SCENE-renderuncert) && done($SCENE-renderpred)" -n 4 -R singularity -R "rusage[mem=30000,scratch=10000,ngpus_excl_p=1]" -W 24:00 "singularity run --nv --bind /cluster/home/blumh/tensorflow_datasets:/cluster/home/blumh/tensorflow_datasets --bind \$TMPDIR:/tmp --bind /cluster/scratch/blumh/:/cluster/scratch/blumh/ --bind /cluster/home/blumh/.cache:/cluster/home/blumh/.cache /cluster/work/riner/users/blumh/clustering.simg bash -c 'cd /semseg && python3 deeplab/scannet_uhlemeyer.py with subset=$SCENE pretrained_model=$MODEL pred_name=pred uncert_name=maxlogit-pp eps=3.5 min_samples=10'"
bsub -w "done($SCENE-renderuncert) && done($SCENE-renderpred)" -n 4 -R singularity -R "rusage[mem=30000,scratch=10000,ngpus_excl_p=1]" -W 24:00 "singularity run --nv --bind /cluster/home/blumh/tensorflow_datasets:/cluster/home/blumh/tensorflow_datasets --bind \$TMPDIR:/tmp --bind /cluster/scratch/blumh/:/cluster/scratch/blumh/ --bind /cluster/home/blumh/.cache:/cluster/home/blumh/.cache /cluster/work/riner/users/blumh/clustering.simg bash -c 'cd /semseg && python3 deeplab/scannet_uhlemeyer.py with subset=$SCENE pretrained_model=$MODEL pred_name=pseudolabel-pred uncert_name=pseudolabel-maxlogit-pp eps=3.5 min_samples=10'"
bsub -w "done($SCENE-renderuncert) && done($SCENE-renderpred)" -n 4 -R singularity -R "rusage[mem=30000,scratch=10000,ngpus_excl_p=1]" -W 24:00 "singularity run --nv --bind /cluster/home/blumh/tensorflow_datasets:/cluster/home/blumh/tensorflow_datasets --bind \$TMPDIR:/tmp --bind /cluster/scratch/blumh/:/cluster/scratch/blumh/ /cluster/work/riner/users/blumh/clustering.simg bash -c 'cd /semseg && python3 deeplab/scannet_nakajima.py best_mcl_nakajima  with subset=$SCENE pretrained_model=$MODEL n_calls=100 shard=20'"
bsub -w "done($SCENE-renderuncert) && done($SCENE-renderpred)" -n 4 -R singularity -R "rusage[mem=30000,scratch=10000,ngpus_excl_p=1]" -W 4:00 "singularity run --nv --bind /cluster/home/blumh/tensorflow_datasets:/cluster/home/blumh/tensorflow_datasets --bind \$TMPDIR:/tmp --bind /cluster/scratch/blumh/:/cluster/scratch/blumh/ /cluster/work/riner/users/blumh/clustering.simg bash -c 'cd /semseg && python3 deeplab/scannet_segandgeo.py best_hdbscan  with subset=$SCENE pretrained_model=$MODEL n_calls=200 cluster_selection_method=eom'"
bsub -w "done($SCENE-renderuncert) && done($SCENE-renderpred)" -n 4 -R singularity -R "rusage[mem=30000,scratch=10000,ngpus_excl_p=1]" -W 4:00 "singularity run --nv --bind /cluster/home/blumh/tensorflow_datasets:/cluster/home/blumh/tensorflow_datasets --bind \$TMPDIR:/tmp --bind /cluster/scratch/blumh/:/cluster/scratch/blumh/ /cluster/work/riner/users/blumh/clustering.simg bash -c 'cd /semseg && python3 deeplab/scannet_segandgeoandimgnet.py best_hdbscan  with subset=$SCENE pretrained_model=$MODEL n_calls=200 cluster_selection_method=eom'"
bsub -w "done($SCENE-renderuncert) && done($SCENE-renderpred)" -n 4 -R singularity -R "rusage[mem=30000,scratch=10000,ngpus_excl_p=1]" -W 4:00 "singularity run --nv --bind /cluster/home/blumh/tensorflow_datasets:/cluster/home/blumh/tensorflow_datasets --bind \$TMPDIR:/tmp --bind /cluster/scratch/blumh/:/cluster/scratch/blumh/ /cluster/work/riner/users/blumh/clustering.simg bash -c 'cd /semseg && python3 deeplab/scannet_seg_and_imgnet_features.py best_hdbscan  with subset=$SCENE pretrained_model=$MODEL n_calls=200 cluster_selection_method=eom'"
bsub -w "done($SCENE-renderuncert) && done($SCENE-renderpred)" -n 4 -R singularity -R "rusage[mem=30000,scratch=10000,ngpus_excl_p=1]" -W 4:00 "singularity run --nv --bind /cluster/home/blumh/tensorflow_datasets:/cluster/home/blumh/tensorflow_datasets --bind \$TMPDIR:/tmp --bind /cluster/scratch/blumh/:/cluster/scratch/blumh/ /cluster/work/riner/users/blumh/clustering.simg bash -c 'cd /semseg && python3 deeplab/scannet_seg_and_imgnet_features.py best_dbscan  with subset=$SCENE pretrained_model=$MODEL n_calls=200'"
